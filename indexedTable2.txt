IndexedTable<E extends Object|Array>

struct:
  id: NodeId uint = 0
  
  nodes: {[NodeId]: Node {
    id: NodeId
    value: E
    prev?: Node
    next?: Node
  }}
  size: uint = 0
  head: DummyNode {next: tail}
  tail: DummyNode {prev: head}
  cachedArray?: Node[] = null

  indexes: {[indexName: IndexName str]: {[key]: str}: Index {[NodeId]: Node}}

  config: {
    indexes: {[IndexName]: (str|number)[]}
  }

trait:
  constuctor(#initialized?)
  #init()
  $deepCopy(obj: T): T
  $unmodifiableNode(node): UnmodifiableNode {
    id: NodeId
    value = get () => (this.cachedValue ? this.cachedValue : (this.cachedValue = $deepCopy(node.value)))
    prev = get () => $unmodifiableNode(node.prev)
    next = get () => $unmodifiableNode(node.next)
  }

  append(prevNode, value): Node
  insert(nextNode, value): Node
  remove(node)
  update(node, value)
  swap(node1, node2)
  getIndexedNode(indexName, value): Node
  listIndexedNodes(indexName, value): Node[]
  getNode(nodeId): Node
  headNode()
  tailNode()
  clear()
  size()
  isEmpty()
  forEach(fn: (Node, this) => bool, thisArg?)
  toArray(): Node[]
  #nextId()

  addIndex(indexName, columns): this
  removeIndex(indexName): this
  #getIndex(indexName, value): Index
  #setIndex(indexName, node)
  #removeIndex(indexName, node)
  #setIndexes(node)
  #removeIndexes(node)

// # private -> internal_
// $ static
// _ member field
